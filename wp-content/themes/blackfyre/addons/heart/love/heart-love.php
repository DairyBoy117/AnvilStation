<?php/*Name: heartLoveDescription: Adds a "Love It" link to postsAuthor: Phil Martinez | ThemeheartAuthor URI: http://themeheart.com*/class heartLove {	 function __construct()   {        add_action('wp_ajax_heart-love', array(&$this, 'ajax'));		add_action('wp_ajax_nopriv_heart-love', array(&$this, 'ajax'));	}	function ajax($post_id) {	     $blackfyre_allowed = wp_kses_allowed_html( 'post' );		//update		if( isset($_POST['loves_id']) ) {			$post_id = str_replace('heart-love-', '', $_POST['loves_id']);			echo wp_kses($this->love_post($post_id, 'update'), $blackfyre_allowed);		}		//get		else {			$post_id = str_replace('heart-love-', '', $_POST['loves_id']);			echo wp_kses($this->love_post($post_id, 'get'), $blackfyre_allowed);		}		exit;	}	function love_post($post_id, $action = 'get')	{		if(!is_numeric($post_id)) return;		switch($action) {			case 'get':				$love_count = get_post_meta($post_id, '_heart_love', true);				if( !$love_count ){					$love_count = 0;					add_post_meta($post_id, '_heart_love', $love_count, true);				}				return '<span class="heart-love-count"><i class="fa fa-heart"></i>'. $love_count .'</span>';				break;			case 'update':				$love_count = get_post_meta($post_id, '_heart_love', true);				if( isset($_COOKIE['heart_love_'. $post_id]) ) return $love_count;				$love_count++;				update_post_meta($post_id, '_heart_love', $love_count);				setcookie('heart_love_'. $post_id, $post_id, time()*20, '/');				return '<span class="heart-love-count"><i class="fa fa-heart"></i>'. $love_count .'</span>';				break;		}	}	function add_love() {		global $post;		$output = $this->love_post($post->ID);  		$class = 'heart-love';  		$title = esc_html__('Love this', "blackfyre");		if( isset($_COOKIE['heart_love_'. $post->ID]) ){			$class = 'heart-love loved';			$title = esc_html__('You already love this!', "blackfyre");		}		return '<a href="#" class="'. $class .'" id="heart-love-'. $post->ID .'" title="'. $title .'">'. $output .'</a>';	}}global $heart_love;$heart_love = new heartLove();// get the ball rollin'function heart_love() {	global $heart_love;    $blackfyre_allowed = wp_kses_allowed_html( 'post' );	echo wp_kses($heart_love->add_love(),$blackfyre_allowed);}?>